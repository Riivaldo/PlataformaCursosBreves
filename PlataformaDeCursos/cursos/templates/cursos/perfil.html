{% extends 'cursos/base.html' %}
{% load static %}
{% comment %} Espacio block para el titulo de la pagina {% endcomment %}

{% block title %} Perfil {% endblock %}

{% comment %} # muesra eL detalle de los cursos como las fechas de inicio, fin, ademas de los usuarios inscritos a dicho curso {% endcomment %}
{% block content %}
  {% if es_profesor %}
    <div class="perfil-container">
        <div class="foto-perfil">
          <img id="preview-img" src="{% static 'img/perfil_defecto.png' %}" alt="Foto de perfil">
          <label for="upload-input" class="upload-btn">Subir Imagen</label>
          <input type="file" id="upload-input" accept="image/*" style="display: none;">
        </div>
      <div class="infoPerfil">
        <h2>Perfil de {{ user.username }}</h2>
        <h3>Profesor: {{ profesor.nombre }}</h3>
        <p>Especialidad: {{ profesor.especialidad }}</p>
      </div>
    </div>
    <h4>Cursos que imparte:</h4>
    <div class="perfilCursos">
      <ul>
      {% for curso in cursos %}
        <li>{{ curso.titulo }} - 
          <a href="{% url 'subir_material_extra' curso.id %}">Subir Material</a> -
          <a href="{% url 'dashboard'%}">
            <button>Más Detalles</button>
          </a>
        </li>
      {% endfor %}
      </ul>
    </div>

    <!-- ESTUDIANTE PERFIL DE IZQUIERDA -->
  {% else %}
    <div class="perfil-layout">
    <div class="perfil-izquierda">
      <div class="foto-perfil">
        <img id="preview-img" src="{% static 'img/perfil_defecto.png' %}" alt="Foto de perfil">
        <label for="upload-input" class="upload-btn">Subir Imagen</label>
        <input type="file" id="upload-input" accept="image/*" style="display: none;">
      </div>

      <div class="infoPerfil">
        <h2>Perfil de {{ user.username }}</h2>
        <h3>Estudiante</h3>
      </div>

      <div class="edit_btn">
        <a href="{% url 'editar_perfil' %}">
          <button class="btn_editar">Editar información</button>
        </a>
      </div>
    </div>

    <!-- ESTUDIANTE CURSOS A LA DERECHA -->
    <div class="perfil-derecha">
      <h2>Mis Cursos</h2>
      <div class="perfilCursos">
        {% for curso in cursos_info %}
          <div class="tarjetaMaterial">
             <!-- Progreso -->
            <div class="barra-progreso">
              <div class="barra-progreso-llenado" data-porcentaje="{{ curso.porcentaje }}">
                <span class="barra-texto">{{ curso.porcentaje }}% completado</span>
              </div>
            </div>
            <strong><h4>Completados:</h4></strong>
            <ul>
              {% for material in curso.materiales %}
                {% if material.estado == "completado" %}
                  <li>
                    <a href="{% url 'ver_recurso' material.id %}">{{ material.titulo }}</a>
                  </li>
                {% endif %}
              {% endfor %}
            </ul>
            <strong><h4>No Completados:</h4></strong>
            <ul>
              {% for material in curso.materiales %}
                {% if material.estado != "completado" %}
                  <li>
                    <a href="{% url 'ver_recurso' material.id %}">{{ material.titulo }}</a>
                  </li>
                {% endif %}
              {% endfor %}
            </ul>
            <a href="{% url 'progreso_estudiante' %}">
              <button>Más Detalles</button>
            </a>
          </div>
        {% empty %}
          <p>No estás inscrito en ningún curso.</p>
        {% endfor %}
      </div>
    </div>
  </div>
  {% endif %}

{% comment %} # Vizualiza la imagen (no lo guarda),  {% endcomment %}
{% comment %} # ¿Abra que agregar en la BD un formato ImageField?  {% endcomment %}
 <script>
    const input = document.getElementById('upload-input');
    const img = document.getElementById('preview-img');

    input.addEventListener('change', function () {
      const file = input.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          img.src = e.target.result;
        }
        reader.readAsDataURL(file);
      }
    });
  </script>

  {% comment %} # Animacion de la barra de progreso  {% endcomment %}
  <script>
    document.addEventListener("DOMContentLoaded", function () {
    const barras = document.querySelectorAll(".barra-progreso-llenado");

    barras.forEach(barra => {
      const porcentaje = parseInt(barra.dataset.porcentaje || 0);
      let width = 0;
      const animar = () => {
        if (width < porcentaje) {
          width++;
          barra.style.width = width + "%";
          requestAnimationFrame(animar);
        }
      };
      requestAnimationFrame(animar);
    });
  });
</script>
{% endblock %}
